#!/bin/bash

temp_file=$(mktemp)
nmap -sV --script=smtp-strangeport $1 > "$temp_file"

output_file="nmap_results_$(date +%Y%m%d_%H%M%S).txt"

grep -B1 "smtp-strangeport: Mail server on unusual port: possible malware" "$temp_file" > "$output_file"

if [ ! -s "$output_file" ]; then
    echo "No results were saved to $output_file" > "$output_file"
else
    echo "Results saved to $output_file"
fi

rm "$temp_file"
